"use strict";!function(a){a(document).ready((function(){function t(){var t=a(".stm_lms_user_float_menu__user");t.length&&t.find("img").attr("src",a(".stm-lms-user_avatar").find("img").attr("src"))}a(".stm_lms_settings_button").on("click",(function(){a(".stm-lms-user_edit_profile_btn").click()})),a(".stm-lms-user-avatar-edit .delete_avatar").on("click",(function(){var e=a(this),s=e.closest(".stm-lms-user-avatar-edit");s.addClass("loading-avatar");var n=new FormData;n.append("action","stm_lms_delete_avatar"),n.append("nonce",stm_lms_nonces.stm_lms_delete_avatar),e.remove(),a.ajax({url:stm_lms_ajaxurl,type:"POST",data:n,processData:!1,contentType:!1,success:function(a){(s.removeClass("loading-avatar"),a.file)&&(s.find("img").remove(),s.find(".stm-lms-user_avatar").append(a.file),t())}})})),a(".stm-lms-user-avatar-edit input").on("change",(function(){var e=a(this),s=e[0].files,n=e.closest(".stm-lms-user-avatar-edit");if(n.addClass("loading-avatar"),s.length){var i=s[0],o=new FormData;o.append("file",i),o.append("action","stm_lms_change_avatar"),o.append("nonce",stm_lms_nonces.stm_lms_change_avatar),a.ajax({url:stm_lms_ajaxurl,type:"POST",data:o,processData:!1,contentType:!1,success:function(a){n.removeClass("loading-avatar"),a.file&&(n.find("img").attr("src",a.file),t())}})}})),a("[data-container]").on("click",(function(t){t.preventDefault();var e=a('[data-container-open=".stm_lms_private_information"]'),s=a('[data-container-open="'+a(this).attr("data-container")+'"]'),n=s.is(":visible");a("[data-container]").removeClass("active"),a("[data-container-open]").slideUp(),n?e.slideDown():(a(this).addClass("active"),s.slideDown())})),a("body").addClass("stm_lms_chat_page"),new Vue({el:"#stm_lms_edit_account",data:function(){return{data:stm_lms_edit_account_info,loading:!1,message:"",status:"error",additionalFields:[],new_visible:!1,re_type_visible:!1,displayNameOptions:new Set,selectedDisplayName:selectedDisplayName||""}},mounted:function(){void 0!==window.profileForm&&(this.additionalFields=window.profileForm),this.updateDisplayNameOptions(!0)},methods:{generateNameOptions:function(a,t){return a&&t?[a+" "+t,t+" "+a,a,t]:[]},updateDisplayNameOptions:function(){var a=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.data.meta.first_name,s=this.data.meta.last_name;t||this.displayNameOptions.clear(),this.generateNameOptions(e,s).forEach((function(t){a.displayNameOptions.add(t)})),t||this.addUniqueNameOptions()},addUniqueNameOptions:function(){var a=this,t=this.data.meta.first_name,e=this.data.meta.last_name;this.generateNameOptions(t,e).forEach((function(t){a.displayNameOptions.add(t)}))},onFirstNameInput:function(a){this.data.meta.first_name=a.target.value,this.updateDisplayNameOptions(!1)},onLastNameInput:function(a){this.data.meta.last_name=a.target.value,this.updateDisplayNameOptions(!1)},updateDisplayName:function(a){this.data.meta.display_name=a.target.value},processFields:function(t){var e=this;if(Object.keys(t).length>0){var s=function(s){if(t.hasOwnProperty(s)){var n=e.additionalFields.find((function(a){return a.id===s}));if(n)if("checkbox"===n.type){var i=[];a('[name="'.concat(n.slug,'"]')).each((function(){a(this).next().hasClass("masterstudy-form-builder__checkbox-wrapper_checked")&&i.push(a(this).val())})),t[s]=i.join(",")}else"radio"===n.type?a('[name="'.concat(n.slug,'"]')).each((function(){a(this).next().hasClass("masterstudy-form-builder__radio-wrapper_checked")&&(t[s]=a(this).val())})):"file"===n.type?t[s]=a('[name="'.concat(n.slug,'"]')).attr("data-url")||"":t[s]=a('[name="'.concat(n.slug,'"]')).val()}};for(var n in t)s(n)}},saveUserInfo:function(){var t=this,e={},s=t.data.meta;this.processFields(t.data.meta),Object.keys(s).forEach((function(a){t.$set(e,a,s[a])}));var n=stm_lms_ajaxurl+"?action=stm_lms_save_user_info&nonce="+stm_lms_nonces.stm_lms_save_user_info;t.loading=!0,t.message=t.status="",this.$http.post(n,e).then((function(e){t.loading=!1,t.message=e.body.message,t.status=e.body.status,e.body.relogin&&(window.location.href=e.body.relogin);var s={bio:"",facebook:"href",twitter:"href","google-plus":"href",position:"",disable_report_email_notifications:!0,first_name:"",display_name:"",instagram:"href"};for(var n in s)s.hasOwnProperty(n)&&(s[n]?a(".stm_lms_update_field__"+n).attr(s[n],t.data.meta[n]):a(".stm_lms_update_field__"+n).text(t.data.meta[n]))}))},inputType:function(a){return this[a]?"text":"password"}}})}))}(jQuery);