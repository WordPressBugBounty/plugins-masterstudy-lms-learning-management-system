"use strict";function stm_lms_item_match_resize(){var s=jQuery;setTimeout((function(){s(".stm_lms_question_item_match__answers").length&&s(".stm_lms_question_item_match__questions").length&&s(".stm_lms_question_item_match__questions > div").each((function(){var e=s(this),t=e.outerHeight();0===t&&(t=48),s(".col-md-6 > .stm_lms_question_item_match__answers .stm_lms_question_item_match__answer").eq(e.index()).css({"min-height":t+"px"})}))}),1e3)}function stm_lms_start_quiz(){return jQuery(".stm_lms_start_quiz").click(),null}function stm_lms_accept_quiz(){var s=jQuery;return s(".stm_lms_complete_lesson").click(),s(".stm-lms-single_quiz")[0].checkValidity()}!function(s){s(document).ready((function(){function e(){if(stm_lms_item_match_resize(),s(".stm-lms-course__lesson-content").hasClass("no-timer"))return!1;s(".stm_lms_timer").addClass("started");var e="undefined"!=typeof source?source:"";s.ajax({url:stm_lms_ajaxurl,dataType:"json",context:this,data:{quiz_id:stm_lms_lesson_id,action:"stm_lms_start_quiz",nonce:stm_lms_nonces.start_quiz,source:e},complete:function(e){var n;n=1e3*parseInt(e.responseJSON),clearInterval(t),t=setInterval((function(){var e=(new Date).getTime(),m=n-e;if(0<m){var i=Math.floor(m/864e5),a=Math.floor(m%864e5/36e5),l=Math.floor(m%36e5/6e4),o=Math.floor(m%6e4/1e3);if(a<10&&(a="0"+a),l<10&&(l="0"+l),o<10&&(o="0"+o),"00"===a&&l<60)s(".stm_lms_timer__time_h").text(l+":"),s(".stm_lms_timer__time_m").text(o);else if(i<1)s(".stm_lms_timer__time_h").text(a+":"),s(".stm_lms_timer__time_m").text(l);else{var r=s(".stm_lms_timer").attr("data-text-days");s(".stm_lms_timer__time_h").text(i+" "+r)}}if(!_&&m<1001||m<=0)s(".stm_lms_timer").removeClass("started"),clearInterval(t),_=!0,s(".stm-lms-single_quiz input").removeAttr("required"),stm_lms_quiz_vars.prevent_submit=1,s(".stm_lms_complete_lesson").click();else if("undefined"!=typeof stm_lms_quiz_duration){var u=195*(stm_lms_quiz_duration-m)/stm_lms_quiz_duration;s(".stm_lms_timer__icon_timered circle").css({"stroke-dasharray":u+", 300"});var c=360*(stm_lms_quiz_duration-m)/stm_lms_quiz_duration;s(".stm_lms_timer__icon_arrow").css({transform:"rotateZ("+c+"deg)"})}}),1e3)}})}var t;s(".stm_lms_complete_lesson").hasClass("completed")&&s(".stm-lms-lesson_navigation ").addClass("completed"),"undefined"!=typeof H5P&&H5P.externalDispatcher.on("xAPI",(function(e){if(console.log(e),void 0!==e.data.statement.result){var t=e.data.statement.result;t.action="stm_lms_add_h5p_result",t.sources=quiz_data_vars,s.ajax({type:"POST",url:stm_lms_ajaxurl+"?nonce="+stm_lms_nonces.stm_lms_add_h5p_result,dataType:"json",context:this,data:t,beforeSend:function(){!0===t.success&&s("#stm-lms-lessons").addClass("loading"),stm_lms_print_message({event_type:"quiz_sending"})},complete:function(e){void 0!==(e=e.responseJSON).completed&&e.completed?location.reload():s("#stm-lms-lessons").removeClass("loading"),stm_lms_print_message({event_type:"quiz_sent"})}})}})),stm_lms_print_message({event_type:"order_created"}),s(".stm-lms-single_quiz").submit((function(e){if(e.preventDefault(),!parseInt(stm_lms_quiz_vars.prevent_submit)&&!confirm(stm_lms_quiz_vars.confirmation))return!1;var t={},n=[];s(this).serializeArray().forEach((function(s){if(s.name.includes("[]")){var e=s.name.replace("[]","");void 0===t[e]?t[e]=[s.value]:t[e].push(s.value)}else"question_ids"===s.name&&(n=s.value.split(",")),t[s.name]=s.value})),n.length>0&&s.each(n,(function(e,n){var _=s('[name*="questions_sequency['.concat(n,']"]'));_.length>0?(s.each(_,(function(e,n){void 0===t[s(n).val()]&&(t[s(n).val()]=[""])})),delete t[n]):void 0===t[n]&&(t[n]=[""])})),s.ajax({type:"POST",url:stm_lms_ajaxurl+"?nonce="+stm_lms_nonces.user_answers,dataType:"json",context:this,data:t,beforeSend:function(){s(".stm_lms_complete_lesson").addClass("loading"),s(this).find('button[type="submit"]').addClass("loading"),stm_lms_print_message({event_type:"quiz_sending"})},complete:function(e){e=e.responseJSON;s(this).find('button[type="submit"]').removeClass("loading");var t=e&&e.passed?"passed":"not-passed",n=e&&e.progress?e.progress:"0";s(".stm-lms-quiz__result_number span").text(n+"%"),s(".stm-lms-course__lesson-content").addClass(t),e&&e.passed&&s(".stm-lms-quiz__result_passing_grade").after('<div class="stm-lms-quiz__result_actions">'+e.url+"</div>"),stm_lms_print_message({event_type:"quiz_sent"})}})})),s("body").on("click",".btn-close-quiz-modal-results",(function(e){e.preventDefault(),stm_lms_print_message({event_type:"close_quiz"}),window.location.href=s(this).attr("href")})),s(".btn-retake").on("click",(function(){s(this).closest(".stm-lms-course__lesson-content").removeClass("not-passed"),e()})),s(".stm_lms_start_quiz").on("click",(function(t){t.preventDefault(),s(".stm-lms-single_quiz").slideDown(),s(this).slideUp(400,(function(){s(this).remove()})),e()}));var n,_=!1;function m(s,e,t){return t.indexOf(s)===e}function i(){return s(".stm-lms-single_question:not(.stm-lms-single_question_question_bank)").length}s(".stm-lms-single_quiz input").on("change",(function(e){var t=s(".stm-lms-single_quiz").serializeArray(),n=[],_=["source","questions_sequency","action","quiz_id","course_id"],a=[];t.forEach((function(s,e){s.name=s.name.replace(new RegExp("\\[.*?\\]","g"),""),-1===n.indexOf(s.name)&&""!==s.value&&n.push(s.name),_.includes(s.name)&&a.push(s.name)})),a=a.filter(m);var l=n.length-a.length;s(".stm_lms_timer__answered strong").text(l),stm_lms_print_message({event_type:"answered_questions",answered_questions:{total:i(),answered:l}})})),n=i(),s(".stm_lms_timer__answered label").text(n),stm_lms_print_message({event_type:"answered_questions",answered_questions:{total:i(),answered:0}}),s(".stm-lms-single_question_question_bank").each((function(){0===s(this).find(".stm-lms-single_question").length&&s(this).prev().hide()})),s(".stm-lms-course__lesson-content.passed .stm-lms-quiz__result__overlay").on("click",(function(e){e.preventDefault(),s(".stm-lms-course__lesson-content").removeClass("passed")}))})),s(window).on("load",(function(){stm_lms_item_match_resize()}))}(jQuery);