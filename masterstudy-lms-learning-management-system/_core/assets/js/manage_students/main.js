"use strict";!function(e){e(document).ready((function(){var t=e("#masterstudy-manage-students"),a=t.find(".masterstudy-table"),s=a.find(".masterstudy-tbody"),d=10,n="",r="",i="",o=!0,u=new MasterstudyPagination({visibleNumber:3,perPageLimit:d,dataListContainer:".masterstudy-tbody",dataItemElementsClass:".masterstudy-table__item",dataItemExcludeClass:"masterstudy-table__item--hidden",dataItemDisplayCss:"flex"});function c(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new URLSearchParams(window.location.search).get("course_id");if(i){r&&l();var o=new URLSearchParams(n).toString(),c="".concat(ms_lms_resturl,"/students/").concat(i,"?").concat(o);m(),fetch(c,{method:"GET",headers:{"X-WP-Nonce":ms_lms_nonce,"Content-Type":"application/json"}}).then((function(e){if(e.ok)return e.json()})).then((function(n){setTimeout((function(){m(!0),function(n,r){n&&(r&&l(),function(t){if(s.find(".masterstudy-table__item.not-founded").remove(),0===t){var n=s.find(".masterstudy-table__item").eq(1).clone();n.removeClass("masterstudy-table__item--hidden"),n.addClass("not-founded"),s.append(n)}t<=1&&10===d?a.find(".masterstudy-tfooter").addClass("masterstudy-tfooter--hidden"):(1===t?e(".masterstudy-pagination").addClass("hidden"):e(".masterstudy-pagination").removeClass("hidden"),a.find(".masterstudy-tfooter").removeClass("masterstudy-tfooter--hidden"))}(n.max_pages),t.find(".masterstudy-manage-students__count-number").text(n.total),u.paginate(n.max_pages,n.per_page,r),e.each(n.students,(function(t,a){!function(t,a,d,n){var r=s.find(".masterstudy-table__item:first").clone();r.removeClass("masterstudy-table__item--hidden"),r.find(".masterstudy-tcell__data").each((function(t,s){var d,n,r,i,o,u=e(s).data("key"),c=a[u]||0===a[u]?a[u]:"";switch(u){case"login":void 0!==e(s).parent().attr("href")&&e(s).parent().attr("href",a.student.url),e(s).parent().before(null!==(d=a.student.avatar)&&void 0!==d?d:""),e(s).text(null!==(n=a.student[u])&&void 0!==n?n:"");break;case"email":e(s).text(null!==(r=a.student[u])&&void 0!==r?r:"");break;case"subscribed":e(s).text(c),e(s).attr("data-value",null!==(i=a.subscribed_time)&&void 0!==i?i:0);break;case"ago":e(s).text(c),e(s).attr("data-value",null!==(o=a.start_time)&&void 0!==o?o:0);break;case"progress_percent":a.subscribed_time?e(s).find(".masterstudy-progress").hide():e(s).find(".masterstudy-progress__bar-filled").css({width:"".concat(c,"%")});case"progress_link":var l=e(s).find('[data-id="manage-students-view-progress"]');a.subscribed_time?l.hide():l.attr("href",c);break;case"course_id":var m;if(e(s).find('[data-id="manage-students-delete"]').attr("data-course-id",c),e(s).find('[data-id="manage-students-delete"]').attr("data-student-id",a.user_id||0),a.subscribed_time)e(s).find('[data-id="manage-students-delete"]').attr("data-subscribed-email",null!==(m=a.student.email)&&void 0!==m?m:"");break;default:e(s).text(c)}})),r.attr("data-initial-order",t+1+(d-1)*n),s.append(r)}(t,a,n.page,n.per_page)})))}(n,r)}),1500)})).catch((function(e){throw e}))}}function l(){var t=s.find(".masterstudy-table__item");e.each(t,(function(t,a){1<t&&e(a).remove()}))}function m(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])s.find(".masterstudy-loader").remove();else if(s.find(".masterstudy-loader").length<1){var t=e(".masterstudy-loader").clone();t.css({display:"block"}),s.append(t)}}u.onPageChange((function(e,t){1!==e&&(t||(a.find(".masterstudy-tfooter").addClass("masterstudy-tfooter--hidden"),c({per_page:d,s:n,page:e,orderby:i,order:r,subscribed:o},!1)))})),c({per_page:d,s:n,page:1,subscribed:o}),document.addEventListener("msAddStudentEvent",(function(e){100===e.detail.progress&&c({per_page:d,s:n,page:1,subscribed:o},!0)})),document.addEventListener("msSortIndicatorEvent",(function(e){r=e.detail.sortOrder,i=e.detail.indicator.parents(".masterstudy-tcell__header").data("sort"),a.find(".masterstudy-tfooter").addClass("masterstudy-tfooter--hidden"),c({per_page:d,s:n,page:1,orderby:i,order:r="none"===r?"asc":r,subscribed:o},!0)})),document.addEventListener("msfieldEvent",(function(t){var s=t.detail.value;switch(a.find(".masterstudy-tfooter").addClass("masterstudy-tfooter--hidden"),t.detail.name){case"s":n=s||"",e(".masterstudy-select__clear").click(),e(".masterstudy-select").removeClass("masterstudy-select_open");break;case"per_page":d=s||10}c({per_page:d,s:n,page:1,subscribed:o},!0)}));var f=e("[data-id='masterstudy-manage-students-delete-student']"),p="",_="";function y(e){e.preventDefault(),f.removeClass("masterstudy-alert_open")}f.css("display","none"),e("body").on("click",'[data-id="manage-students-delete"]',(function(t){var a;t.preventDefault(),f.css("display","flex"),f.addClass("masterstudy-alert_open"),p=e(this).data("student-id"),_=null!==(a=e(this).data("subscribed-email"))&&void 0!==a?a:""})),f.find("[data-id='submit']").click((function(e){e.preventDefault();var t=new URLSearchParams(window.location.search).get("course_id"),a="".concat(ms_lms_resturl,"/student/").concat(t,"/").concat(p),s=_.length>0?JSON.stringify({subscribed_email:_}):void 0;fetch(a,{method:"DELETE",headers:{"X-WP-Nonce":ms_lms_nonce,"Content-Type":"application/json"},body:s}).then((function(e){if(e.ok)return e.json()})).then((function(e){f.removeClass("masterstudy-alert_open"),"ok"===e.status&&c({per_page:d,s:n,page:1,subscribed:o},!0)})).catch((function(e){throw e}))})),f.find("[data-id='cancel']").click(y),f.find(".masterstudy-alert__header-close").click(y),e("#main").addClass("masterstudy-manage-students__main")}))}(jQuery);