"use strict";!function(e){e(document).ready((function(){function t(){var t={},s=[];e(".masterstudy-course-player-quiz__form").serializeArray().forEach((function(a){if(a.name.includes("[]")){var r=a.name.replace("[]","");void 0===t[r]?t[r]=[a.value]:t[r].push(a.value)}else"question_ids"===a.name&&(s=a.value.split(",")),t[a.name]=a.value;s.length>0&&e.each(s,(function(s,a){var r=e('[name*="questions_sequency['.concat(a,']"]'));r.length>0?(e.each(r,(function(s,a){void 0===t[e(a).val()]&&(t[e(a).val()]=[""])})),delete t[a]):void 0===t[a]&&(t[a]=[""])}))})),e.ajax({type:"POST",url:quiz_data.ajax_url+"?nonce="+quiz_data.submit_nonce,dataType:"json",context:this,data:t,beforeSend:function(){e("[data-id='quiz_alert']").removeClass("masterstudy-alert_open"),e("[data-id='submit-quiz']").addClass("masterstudy-button_loading")},success:function(e){if(quiz_data.is_single_quiz){var t=new Date;t.setTime(t.getTime()+36e5),document.cookie="quiz_user_answer_id=".concat(e.user_answer_id,";expires=").concat(t.toUTCString(),";path=/");var s=s=new URL(window.location.href);s.searchParams.set("show_answers",e.user_answer_id),s.searchParams.set("progress",e.progress),window.location.href=s}else location.reload()}})}function s(){!quiz_data.duration>0||e.ajax({url:quiz_data.ajax_url,dataType:"json",context:this,data:{quiz_id:quiz_data.quiz_id,action:"stm_lms_start_quiz",nonce:quiz_data.start_nonce,source:quiz_data.course_id},success:function(s){var u;e(".masterstudy-course-player-quiz-timer").length>0&&(u=1e3*parseInt(s),clearInterval(a),a=setInterval((function(){var s=(new Date).getTime(),i=u-s,m=Math.floor(i/864e5),o=Math.floor(i%864e5/36e5),n=Math.floor(i%36e5/6e4),c=Math.floor(i%6e4/1e3);if(o<10&&(o="0"+o),n<10&&(n="0"+n),c<10&&(c="0"+c),"00"===o&&n<60)e(".masterstudy-course-player-quiz-timer__minutes").text(n),e(".masterstudy-course-player-quiz-timer__seconds").text(c),e('.masterstudy-course-player-quiz-timer__separator[data-id="minutes"]').addClass("masterstudy-course-player-quiz-timer__separator_show");else if(m<1)e(".masterstudy-course-player-quiz-timer__hours").text(o),e(".masterstudy-course-player-quiz-timer__minutes").text(n),e(".masterstudy-course-player-quiz-timer__seconds").text(c),e(".masterstudy-course-player-quiz-timer__separator").addClass("masterstudy-course-player-quiz-timer__separator_show");else{var d=e(".masterstudy-course-player-quiz-timer").attr("data-text-days");e(".masterstudy-course-player-quiz-timer__days").text(m+" "+d)}!r&&i<1001&&(clearInterval(a),r=!0,quiz_data.prevent_submit=1,t())}),1e3),e(".masterstudy-course-player-quiz-timer").addClass("masterstudy-course-player-quiz-timer_started"))}})}"undefined"!=typeof H5P&&H5P.externalDispatcher.on("xAPI",(function(t){if(void 0!==t.data.statement.result){var s=t.data.statement.result;s.action="stm_lms_add_h5p_result",s.sources={post_id:quiz_data.course_id,item_id:quiz_data.quiz_id},e.ajax({type:"POST",url:quiz_data.ajax_url+"?nonce="+quiz_data.h5p_nonce,dataType:"json",context:this,data:s,beforeSend:function(){!0===s.success&&e("#stm-lms-lessons").addClass("loading")},complete:function(t){void 0!==(t=t.responseJSON).completed&&t.completed?location.reload():e("#stm-lms-lessons").removeClass("loading")}})}})),e("[data-id='start-quiz']").click((function(t){t.preventDefault(),e(".masterstudy-course-player-quiz__form").removeClass("masterstudy-course-player-quiz__form_hide"),e(".masterstudy-course-player-navigation__submit-quiz").removeClass("masterstudy-course-player-navigation__submit-quiz_hide"),e(".masterstudy-course-player-content__header").hide(),e(".masterstudy-course-player-quiz__content").hide(),e(".masterstudy-course-player-quiz__content-meta").hide(),e(".masterstudy-course-player-quiz__start-quiz").hide(),e(".masterstudy-course-player-header__navigation-quiz").addClass("masterstudy-course-player-header__navigation-quiz_show"),e(".masterstudy-course-player-quiz__navigation-tabs").addClass("masterstudy-course-player-quiz__navigation-tabs_show"),e(".masterstudy-course-player-question__content").find(".masterstudy-course-player-item-match").length>0&&u(),e(".masterstudy-course-player-question__content").find(".masterstudy-course-player-image-match").length>0&&i(),s()})),e("[data-id='submit-quiz']").click((function(t){t.preventDefault(),e("[data-id='quiz_alert']").addClass("masterstudy-alert_open")})),e("[data-id='quiz_alert']").find("[data-id='submit']").click((function(e){e.preventDefault(),t()})),e("[data-id='quiz_alert']").find("[data-id='cancel']").click((function(t){t.preventDefault(),e("[data-id='quiz_alert']").removeClass("masterstudy-alert_open")})),e("[data-id='quiz_alert']").find(".masterstudy-alert__header-close").click((function(t){t.preventDefault(),e("[data-id='quiz_alert']").removeClass("masterstudy-alert_open")})),e(".masterstudy-course-player-quiz__result-retake .masterstudy-button").click((function(){var t=e(".masterstudy-course-player-question__content"),a=e(".masterstudy-course-player-quiz__form"),r=e(".masterstudy-course-player-navigation__submit-quiz"),m=t.find(".masterstudy-course-player-answer input"),o=t.find(".masterstudy-course-player-answer__checkbox"),n=t.find(".masterstudy-course-player-answer__radio"),c=t.find(".masterstudy-course-player-answer__status-wrong"),d=t.find(".masterstudy-course-player-answer__status-correct"),_=t.find(".masterstudy-course-player-item-match"),l=t.find(".masterstudy-course-player-image-match"),y=t.find(".masterstudy-course-player-fill-the-gap"),h=t.find(".masterstudy-course-player-quiz-keywords");a.removeClass("masterstudy-course-player-quiz__form_hide"),r.removeClass("masterstudy-course-player-navigation__submit-quiz_hide"),t.find(".masterstudy-course-player-answer").removeClass("masterstudy-course-player-answer_show-answers masterstudy-course-player-answer_correct masterstudy-course-player-answer_wrong"),m.prop("checked",!1),o.removeClass("masterstudy-course-player-answer__checkbox_checked"),n.removeClass("masterstudy-course-player-answer__radio_checked"),c.hide(),d.hide(),e(".masterstudy-course-player-quiz").removeClass("masterstudy-course-player-quiz_show-answers"),e(".masterstudy-pagination__item-indicator").removeClass("masterstudy-pagination__item-indicator_done"),e(".masterstudy-course-player-quiz__navigation-tabs").addClass("masterstudy-course-player-quiz__navigation-tabs_show"),_.length>0&&(_.removeClass("masterstudy-course-player-item-match_not-drag"),_.find(".masterstudy-course-player-item-match__question-answer .masterstudy-course-player-item-match__answer-item").remove(),_.find(".masterstudy-course-player-item-match__question-answer-text").removeClass("masterstudy-course-player-item-match__question-answer-text_hide"),_.find(".masterstudy-course-player-item-match__answer").removeClass("masterstudy-course-player-item-match__answer_hide"),_.find(".masterstudy-course-player-item-match__question").removeClass("masterstudy-course-player-item-match__question_correct masterstudy-course-player-item-match__question_wrong masterstudy-course-player-item-match__question_full"),_.find(".masterstudy-course-player-item-match__input").val("").attr("value",""),u()),l.length>0&&(l.removeClass("masterstudy-course-player-image-match_not-drag"),l.find(".masterstudy-course-player-image-match__question-answer-wrongly").remove(),l.find(".masterstudy-course-player-image-match__question-answer .masterstudy-course-player-image-match__answer-item").remove(),l.find(".masterstudy-course-player-image-match__question-answer-drag-text").removeClass("masterstudy-course-player-image-match__question-answer-drag-text_hide"),l.find(".masterstudy-course-player-image-match__answer").removeClass("masterstudy-course-player-image-match__answer_hide"),l.find(".masterstudy-course-player-image-match__question").removeClass("masterstudy-course-player-image-match__question_correct masterstudy-course-player-image-match__question_wrong masterstudy-course-player-image-match__question_full"),l.find(".masterstudy-course-player-image-match__question-status").addClass("masterstudy-course-player-image-match__question-status_hide"),l.find(".masterstudy-course-player-image-match__input").val("").attr("value",""),i()),y.length>0&&(y.find(".masterstudy-course-player-fill-the-gap__questions").removeClass("hidden"),y.find(".masterstudy-course-player-fill-the-gap__answers").remove()),h.length>0&&(h.find(".masterstudy-course-player-quiz-keywords__questions").removeClass("hidden"),h.find(".masterstudy-course-player-quiz-keywords__user_answers").remove()),e(".masterstudy-course-player-content__header").hide(),e(".masterstudy-course-player-quiz__content").hide(),e(".masterstudy-course-player-quiz__content-meta").hide(),e(".masterstudy-course-player-quiz__result-container").hide(),e(".masterstudy-course-player-answer__hint").hide(),e(".masterstudy-course-player-header__navigation-quiz").addClass("masterstudy-course-player-header__navigation-quiz_show"),e(".masterstudy-tabs-attempts-history").hide(),s()})),e(".masterstudy-course-player-quiz__navigation-tabs .masterstudy-tabs-pagination__item-block").click((function(){var t=e(this).data("id");document.querySelector('.masterstudy-course-player-quiz__form [data-number-question="'.concat(t,'"]')).scrollIntoView({behavior:"smooth"})}));var a,r=!1;function u(){e(".masterstudy-course-player-item-match:not(.masterstudy-course-player-item-match_not-drag)").each((function(t){var s="item_drag_"+t;e(this).find(".masterstudy-course-player-item-match__answer, .masterstudy-course-player-item-match__question-answer").sortable({connectWith:"."+s+".masterstudy-course-player-item-match__question-answer",appendTo:"."+s+".masterstudy-course-player-item-match__answer",helper:"clone",start:function(t,s){e(s.helper).css("cursor","grabbing")},stop:function(t,s){e(s.helper).css("cursor","grab")},over:function(t,s){var a=e(this);a.hasClass("masterstudy-course-player-item-match__question-answer")&&a.addClass("masterstudy-course-player-item-match__question-answer_highlight")},out:function(t,s){var a=e(this);a.hasClass("masterstudy-course-player-item-match__question-answer")&&a.removeClass("masterstudy-course-player-item-match__question-answer_highlight")},remove:function(t,s){var a=e(this);a.hasClass("masterstudy-course-player-item-match__question-answer")&&(a.closest(".masterstudy-course-player-item-match__question-answer-wrapper").find(".masterstudy-course-player-item-match__question-answer-text").show(),a.closest(".masterstudy-course-player-item-match__question").removeClass("masterstudy-course-player-item-match__question_full"))},receive:function(t,s){var a=e(this),r=e(s.sender);if(a.hasClass("masterstudy-course-player-item-match__question-answer")&&(a.closest(".masterstudy-course-player-item-match__question-answer-wrapper").find(".masterstudy-course-player-item-match__question-answer-text").hide(),a.closest(".masterstudy-course-player-item-match__question").addClass("masterstudy-course-player-item-match__question_full")),a.children().length>1&&(e(s.sender).sortable("cancel"),a.hasClass("masterstudy-course-player-item-match__question-answer")&&r.hasClass("masterstudy-course-player-item-match__question-answer"))){var u=a.find(".masterstudy-course-player-item-match__answer-item-content"),i=r.find(".masterstudy-course-player-item-match__answer-item-content"),m=u.text(),o=i.text();u.text(o),i.text(m),a.closest(".masterstudy-course-player-item-match__question-answer-wrapper").find(".masterstudy-course-player-item-match__question-answer-text").hide(),r.closest(".masterstudy-course-player-item-match__question-answer-wrapper").find(".masterstudy-course-player-item-match__question-answer-text").hide(),a.closest(".masterstudy-course-player-item-match__question").addClass("masterstudy-course-player-item-match__question_full"),r.closest(".masterstudy-course-player-item-match__question").addClass("masterstudy-course-player-item-match__question_full")}var n=[],c=a.closest(".masterstudy-course-player-item-match").find(".masterstudy-course-player-item-match__question");c.length>0&&c.each((function(){var t=e(this).closest(".masterstudy-course-player-item-match").find(".masterstudy-course-player-item-match__input"),s=e(this).find(".masterstudy-course-player-item-match__answer-item-content"),a=s.find('script[type="math/tex"]'),r="";r=a.length?a.text().trim():s.length?s.text().trim():"",n.push(r);var u="[stm_lms_item_match]"+n.join("[stm_lms_sep]");t.val(u)}))}}).addClass(s)}))}function i(){e(".masterstudy-course-player-image-match:not(.masterstudy-course-player-image-match_not-drag)").each((function(t){var s="image_drag_"+t;e(this).find(".masterstudy-course-player-image-match__answer, .masterstudy-course-player-image-match__question-answer").sortable({connectWith:"."+s+".masterstudy-course-player-image-match__question-answer",appendTo:"."+s+".masterstudy-course-player-image-match__answer",helper:"clone",start:function(t,s){var a,r=e(s.item).parent().hasClass("masterstudy-course-player-image-match__question-answer"),u=e(s.helper).closest(".masterstudy-course-player-image-match").hasClass("masterstudy-course-player-image-match_style-grid"),i=window.matchMedia("(max-width: 576px)").matches;e(s.helper).css("cursor","grabbing"),r&&(a=u?i?"105px":"177px":i?"105px":"280px",e(s.helper).find("img").css("height",a))},stop:function(t,s){e(s.helper).css("cursor","grab"),e(s.helper).css("width","100%")},over:function(t,s){var a=e(this);a.hasClass("masterstudy-course-player-image-match__question-answer")&&a.addClass("masterstudy-course-player-image-match__question-answer_highlight")},out:function(t,s){var a=e(this);a.hasClass("masterstudy-course-player-image-match__question-answer")&&a.removeClass("masterstudy-course-player-image-match__question-answer_highlight")},remove:function(t,s){var a=e(this);a.hasClass("masterstudy-course-player-image-match__question-answer")&&(a.closest(".masterstudy-course-player-image-match__question-answer-wrapper").find(".masterstudy-course-player-image-match__question-answer-drag-text").show(),a.closest(".masterstudy-course-player-image-match__question").removeClass("masterstudy-course-player-image-match__question_full"))},receive:function(t,s){var a=e(this),r=e(s.sender);if(a.hasClass("masterstudy-course-player-image-match__question-answer")&&(a.closest(".masterstudy-course-player-image-match__question-answer-wrapper").find(".masterstudy-course-player-image-match__question-answer-drag-text").hide(),a.closest(".masterstudy-course-player-image-match__question").addClass("masterstudy-course-player-image-match__question_full")),a.children().length>1&&(e(s.sender).sortable("cancel"),a.hasClass("masterstudy-course-player-image-match__question-answer")&&r.hasClass("masterstudy-course-player-image-match__question-answer"))){var u=a.find(".masterstudy-course-player-image-match__answer-item-content img"),i=r.find(".masterstudy-course-player-image-match__answer-item-content img"),m=r.find(".masterstudy-course-player-image-match__answer-item-text"),o=a.find(".masterstudy-course-player-image-match__answer-item-text"),n=u.attr("src"),c=i.attr("src"),d=m.text(),_=o.text(),l=r.find(".masterstudy-course-player-image-match__answer-item-container_hide").length>0,y=a.find(".masterstudy-course-player-image-match__answer-item-container_hide").length>0;u.attr("src",c),i.attr("src",n),m.text(_),o.text(d),l&&!y?(r.find(".masterstudy-course-player-image-match__answer-item-container").removeClass("masterstudy-course-player-image-match__answer-item-container_hide"),a.find(".masterstudy-course-player-image-match__answer-item-container").addClass("masterstudy-course-player-image-match__answer-item-container_hide")):y&&!l&&(r.find(".masterstudy-course-player-image-match__answer-item-container").addClass("masterstudy-course-player-image-match__answer-item-container_hide"),a.find(".masterstudy-course-player-image-match__answer-item-container").removeClass("masterstudy-course-player-image-match__answer-item-container_hide")),a.closest(".masterstudy-course-player-image-match__question-answer-wrapper").find(".masterstudy-course-player-image-match__question-answer-drag-text").hide(),r.closest(".masterstudy-course-player-image-match__question-answer-wrapper").find(".masterstudy-course-player-image-match__question-answer-drag-text").hide(),a.closest(".masterstudy-course-player-image-match__question").addClass("masterstudy-course-player-image-match__question_full"),r.closest(".masterstudy-course-player-image-match__question").addClass("masterstudy-course-player-image-match__question_full")}var h=[],p=a.closest(".masterstudy-course-player-image-match").find(".masterstudy-course-player-image-match__question");p.length>0&&p.each((function(){var t=e(this).closest(".masterstudy-course-player-image-match").find(".masterstudy-course-player-image-match__input"),s=e(this).find(".masterstudy-course-player-image-match__answer-item-content"),a=s.length?s.find(".masterstudy-course-player-image-match__answer-item-text").text().trim():"";e(this).find(".masterstudy-course-player-image-match__answer-item-content img").length>0&&(a+="|"+e(this).find(".masterstudy-course-player-image-match__answer-item-content img").attr("src")),h.push(a);var r="[stm_lms_image_match]"+h.join("[stm_lms_sep]");t.val(r)}))}}).addClass(s)}))}}))}(jQuery);