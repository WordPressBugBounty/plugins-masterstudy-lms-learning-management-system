"use strict";!function(e){var s=[],n=e("body");function a(){var n=e(".group-emails");n.html(""),s.forEach((function(e,s){n.append("<div class='group-emails-container'><span data-index='"+s+"'>"+e+"</span><i class='stmlms-cross'></i></div>")}))}function t(){var e=n.find(".btn-add-group");n.find("#group_name").val().length&&s.length?e.addClass("activex"):e.removeClass("activex")}function r(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}e(document).ready((function(){var i=e(".buy-enterprise"),o=[];n.on("click",".stm_lms_select_group",(function(){var s=e(this);i=e(".buy-enterprise"),s.toggleClass("active"),function(){o=[];var s=0;e(".stm_lms_select_group").each((function(){var n=e(this);n.hasClass("active")&&(s++,o.push(n.attr("data-group-id")))}));var n=i.data("enterprise-price");i.find("span").html(stm_lms_price_format(n*s)),o.length?i.removeClass("disabled"):i.addClass("disabled")}()})),n.on("click",".buy-enterprise",(function(s){s.preventDefault();var n=e(this);if(!o.length)return!1;e.ajax({url:stm_lms_ajaxurl,dataType:"json",context:this,data:{action:"stm_lms_add_to_cart_enterprise",groups:o,course_id:n.data("course-id"),nonce:stm_lms_nonces.stm_lms_add_to_cart_enterprise},beforeSend:function(){n.addClass("loading")},complete:function(e){e=e.responseJSON,n.removeClass("loading"),e.redirect?window.location.replace(e.cart_url):n.html(e.text).attr("href",e.cart_url).removeClass("buy-enterprise")}})}));var l=e("#group_email");n.on("click",".create_group",(function(s){s.preventDefault(),e(".stm_lms_popup_create_group").toggleClass("active"),e(".stm_lms_popup_create_group__inner").find(".group-emails").children().length<2&&e(".stm_lms_popup_create_group__inner").find(".heading_font").children().removeClass("warning")})),n.on("keydown change","#group_name",(function(e){t()})),n.on("keyup change","#group_email",(function(s){var n=l=e(this),a=n.val();r(a)&&n.removeClass("invalid").addClass("valid"),r(a)||n.removeClass("valid").addClass("invalid"),a.length||n.removeClass("invalid valid")})),n.on("click",".add_email",(function(){var n=l.val(),i=e(".stm_lms_popup_create_group__inner").data("max-group")-1;return i=i>0?i:4,!(r(n)&&!s.includes(n))||(e(this).parents(".stm_lms_popup_create_group__inner").find(".group-emails").children().length>i?(e(this).parents(".stm_lms_popup_create_group__inner").find(".heading_font").children().addClass("warning"),!0):(e(this).parents(".stm_lms_popup_create_group__inner").find(".heading_font").children().removeClass("warning"),s.push(n),l.val("").removeClass("invalid valid"),a(),void t()))})),n.on("click",".stmlms-cross",(function(){var n=e(this).parent().find("span").text(),a=s.indexOf(n);s.splice(a,1),e(this).parent().remove(),s.length<2&&e(".stm_lms_popup_create_group__inner").find(".heading_font").children().removeClass("warning"),s.length<1&&e(".btn-add-group").removeClass("activex")})),n.on("click",".btn-add-group",(function(r){if(r.preventDefault(),!e(this).hasClass("activex"))return!1;var i=n.find("#group_name"),o=n.find(".stm_lms_group_new_error"),l=n.find(".stm_lms_popup_create_group"),_={title:i.val(),emails:s};e.ajax({url:stm_lms_ajaxurl+"?action=stm_lms_add_enterprise_group&nonce="+stm_lms_nonces.stm_lms_add_enterprise_group,type:"POST",data:JSON.stringify(_),dataType:"json",contentType:"application/json",beforeSend:function(){o.hide(),l.addClass("loading")},success:function(r){if(l.removeClass("loading"),r.message&&o.html(r.message).show(),"error"===r.status)return!1;e(".stm_lms_popup_create_group").removeClass("active"),n.find(".stm_lms_select_group__list").append('<div class="stm_lms_select_group" data-group-id="'+r.group.post_id+'"><span>'+r.group.title+"</span></div>"),s=[],n.find("#group_name").val(""),a(),t(),n.find(".actions.no-groups").removeClass("no-groups"),n.find(".no-groups-message").remove()}})}))}))}(jQuery);