"use strict";function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach((function(e){_defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}Vue.component("grades_table",{props:["fields"],components:{"slider-picker":VueColor.Chrome},data:function(){return{newRow:this.initializeNewRow(),colorValue:{r:255,g:255,b:255,a:1},colorInputValue:"rgba(255, 255, 255, 1)",showConfirmDelete:!1,validationErrors:{}}},created:function(){if("string"==typeof this.newRow.color){this.colorInputValue=this.newRow.color;var t=this.newRow.color.replace("rgba(","").slice(0,-1).split(",");this.colorValue.r=parseInt(t[0]),this.colorValue.g=parseInt(t[1]),this.colorValue.b=parseInt(t[2]),this.colorValue.a=parseFloat(t[3])}},template:'\n\t\t<div class="wpcfto_generic_field" v-if="fields.options && Object.keys(fields.options).length">\n\t\t\t<div class="grades_table">\n\t\t\t\t<div class="grades_table__title">{{ fields.label }}</div>\n\t\t\t\t<div class="grades_table__wrapper">\n\t\t\t\t\t<div class="grades_table__header">\n\t\t\t\t\t\t<div v-for="(column, key) in fields.options"\n\t\t\t\t\t\t\tv-if="key !== \'color\'"\n\t\t\t\t\t\t\t:key="key"\n\t\t\t\t\t\t\t:style="{ width: column.width }"\n\t\t\t\t\t\t\t:class="\'grades_table__column grades_table__column_\' + column.type"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ column.title }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="grades_table__body">\n\t\t\t\t\t\t<div v-for="(row, rowIndex) in fields.value" :key="rowIndex" class="grades_table__row">\n\t\t\t\t\t\t\t<div v-for="(column, key) in fields.options"\n\t\t\t\t\t\t\t\tv-if="key !== \'color\'"\n\t\t\t\t\t\t\t\t:key="key"\n\t\t\t\t\t\t\t\t:style="{ width: column.width }"\n\t\t\t\t\t\t\t\t:class="\'grades_table__item grades_table__item_\' + column.type"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span v-if="key === \'grade\'" class="grades_table__item-grade" :style="{ background: row.color }">\n\t\t\t\t\t\t\t\t\t{{ row[key] }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span v-else-if="Array.isArray(row[key])" class="grades_table__item-value">\n\t\t\t\t\t\t\t\t\t{{ row[key].map(val => val + \'%\').join(\' - \') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span v-else class="grades_table__item-value">\n\t\t\t\t\t\t\t\t\t{{ row[key] || \'\' }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span v-if="rowIndex === fields.value.length - 1" @click="confirmDelete" class="grades_table__row-delete">\n\t\t\t\t\t\t\t\t<i class="fa fa-trash"></i>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="grades_table__add-row">\n\t\t\t\t\t<div v-for="(column, key) in fields.options" :key="key" class="grades_table__input-wrapper">\n\t\t\t\t\t\t<span class="grades_table__input-title">\n\t\t\t\t\t\t\t{{ column.title }}{{ column.type === \'range\' ? \' min, %\' : \'\' }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input v-if="column.type === \'text\' || column.type === \'badge\'"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tv-model="newRow[key]"\n\t\t\t\t\t\t\tplaceholder="A+"\n\t\t\t\t\t\t\tclass="grades_table__input"\n\t\t\t\t\t\t\t:class="{\'grades_table__input_error\': validationErrors[key]}"\n\t\t\t\t\t\t\t@input="clearValidationError(key)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input v-else-if="column.type === \'number\'"\n\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\tmin="0"\n\t\t\t\t\t\t\tv-model="newRow[key]"\n\t\t\t\t\t\t\tplaceholder="1"\n\t\t\t\t\t\t\tclass="grades_table__input"\n\t\t\t\t\t\t\t:class="{\'grades_table__input_error\': validationErrors[key]}"\n\t\t\t\t\t\t\t@input="handleNumberInput(key)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input v-else-if="column.type === \'range\'"\n\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\tmin="0"\n\t\t\t\t\t\t\tv-model="newRow[key]"\n\t\t\t\t\t\t\tplaceholder="20%"\n\t\t\t\t\t\t\tclass="grades_table__input"\n\t\t\t\t\t\t\t:class="{\'grades_table__input_error\': validationErrors[key]}"\n\t\t\t\t\t\t\t@input="handleRangeInput(key)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div v-else-if="column.type === \'color\'" class="stm_colorpicker_wrapper">\n\t\t\t\t\t\t\t<span :style="{\'background-color\': colorInputValue}" @click="focusNextInput"></span>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tv-model="colorInputValue"\n\t\t\t\t\t\t\t\tplaceholder="rgba(255,255,255,1)"\n\t\t\t\t\t\t\t\tclass="grades_table__input"\n\t\t\t\t\t\t\t\t:class="{\'grades_table__input_error\': validationErrors[key] && colorInputValue === \'\'}"\n\t\t\t\t\t\t\t\t@input="handleColorInput(key)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<slider-picker v-model="colorValue"></slider-picker>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="validationErrors[key] && (key !== \'color\' || colorInputValue === \'\')" class="grades_table__error-message">\n\t\t\t\t\t\t\t{{ validationErrors[key] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="grades_table__add-button" @click="addRow">Add</span>\n\t\t\t\t</div>\n\t\t\t\t<div :class="{\'grades_table__popup\': true, \'grades_table__popup_show\': showConfirmDelete}">\n\t\t\t\t\t<div class="grades_table__popup-content">\n\t\t\t\t\t\t<div class="grades_table__popup-text">{{ gradesTable.popup_text }}</div>\n\t\t\t\t\t\t<div class="grades_table__popup-actions">\n\t\t\t\t\t\t\t<span @click="closeDeleteConfirm" class="grades_table__popup-cancel">{{ gradesTable.popup_cancel_button }}</span>\n\t\t\t\t\t\t\t<span @click="deleteLastRow" class="grades_table__popup-confirm">{{ gradesTable.popup_confirm_button }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t',methods:{updateColor:function(t){this.newRow.color=t},initializeNewRow:function(){var t={};for(var e in this.fields.options)t[e]="";return t},focusNextInput:function(){this.$nextTick((function(){var t=event.target.nextElementSibling;t&&"INPUT"===t.tagName&&t.focus()}))},addRow:function(){var t=this,e=!0,n=100;for(var r in this.validationErrors={},this.fields.options)null!==this.newRow[r]&&""!==this.newRow[r]||(e=!1,this.$set(this.validationErrors,r,gradesTable.fields_error));var o=Object.keys(this.fields.options).find((function(e){return"color"===t.fields.options[e].type}));if(o&&""===this.colorInputValue&&(e=!1,this.$set(this.validationErrors,"color",gradesTable.fields_error)),this.fields.value.length>0){var i=this.fields.value[this.fields.value.length-1];n=i.range[0]-1,(void 0===this.newRow.range||this.newRow.range>=i.range[0])&&(e=!1,this.$set(this.validationErrors,"range",this.fields_range_error))}if(this.newRow.range<0&&(e=!1,this.$set(this.validationErrors,"range",this.fields_error)),e){var a=_objectSpread(_objectSpread({},this.newRow),{},{range:[this.newRow.range,n]});this.fields.value.push(a),this.newRow=this.initializeNewRow(),this.resetColorFields()}},clearValidationError:function(t){this.$delete(this.validationErrors,t)},handleNumberInput:function(t){var e=Math.floor(this.newRow[t]);this.newRow[t]=e<0?"":e,this.clearValidationError(t)},handleColorInput:function(t){""===this.colorInputValue?(this.resetColorFields(),this.$set(this.validationErrors,t,this.fields_error)):this.clearValidationError(t)},handleRangeInput:function(t){var e=Math.floor(this.newRow[t]);this.newRow[t]=e<0?0:e,this.clearValidationError(t)},resetColorFields:function(){this.colorInputValue="",this.colorValue={r:"",g:"",b:"",a:""}},confirmDelete:function(){this.showConfirmDelete=!0},closeDeleteConfirm:function(){this.showConfirmDelete=!1},deleteLastRow:function(){this.fields.value.length>0&&this.fields.value.pop(),this.showConfirmDelete=!1}},watch:{colorValue:function(t){if(void 0!==t.rgba){var e="rgba(".concat(t.rgba.r,",").concat(t.rgba.g,",").concat(t.rgba.b,",").concat(t.rgba.a,")");this.colorInputValue=e,this.newRow.color=e}}}});