"use strict";!function(e){e(document).ready((function(){var t=["stm_lms_edit_account"];e(document).on("drop",".masterstudy-file-upload__field",(function(a){a.preventDefault(),e(this).removeClass("masterstudy-file-upload__field_highlight");var l=a.originalEvent.dataTransfer.files,s=e(this),o=d(s,t);i(s,l[0],o,"drag")})),e(document).on("change",".masterstudy-file-upload__input",(function(a){var l=e(this).closest(".masterstudy-file-upload__field");i(l,this,d(l,t),"input")})),e(document).on("click",".masterstudy-file-upload__link",(function(a){a.preventDefault();var i=e(this).closest(".masterstudy-file-upload").find(".masterstudy-file-upload__field"),l=d(i,t),s=e(this).closest(".".concat(l));!function(t,a,d,i){i.find("[data-id='file_upload_file_alert']").addClass("masterstudy-alert_open"),i.find("[data-id='file_upload_file_alert']").find("[data-id='submit']").one("click",(function(d){var l=new FormData;l.append("file_id",t),l.append("action",masterstudy_file_upload_data.file_delete_action),l.append("nonce",masterstudy_file_upload_data.file_delete_nonce),e.ajax({url:masterstudy_file_upload_data.ajax_url,type:"POST",data:l,processData:!1,contentType:!1,beforeSend:function(){i.find("[data-id='file_upload_file_alert']").removeClass("masterstudy-alert_open")},success:function(d){"OK"===d&&(i.find("[data-id='".concat(t,"']")).closest(".masterstudy-file-upload__item").remove(),e(a).parent().find(".masterstudy-file-upload__field-error").removeClass("masterstudy-file-upload__field-error_show"),e(a).find(".masterstudy-file-upload__input").attr("data-url",""),masterstudy_file_upload_data.full_image_view&&e(a).parent().find(".masterstudy-file-upload__field").removeClass("masterstudy-file-upload__field_disabled"))}})}))}(e(this).data("id"),i,0,s)})),e(document).on("dragenter",".masterstudy-file-upload__field",(function(t){t.preventDefault(),e(this).addClass("masterstudy-file-upload__field_highlight")})),e(document).on("dragover",".masterstudy-file-upload__field",(function(e){e.preventDefault()})),e(document).on("dragleave",".masterstudy-file-upload__field",(function(t){var a=this.getBoundingClientRect(),d=t.clientX,i=t.clientY;d>=a.left&&d<=a.right&&i>=a.top&&i<=a.bottom||e(this).removeClass("masterstudy-file-upload__field_highlight")})),e(document).on("click",".masterstudy-file-upload__field-button",(function(){e(this).parent().find(".masterstudy-file-upload__input").click()})),e(document).on("click","[data-id='cancel'], .masterstudy-alert__header-close",(function(t){t.preventDefault(),e(this).closest("[data-id='file_upload_file_alert']").removeClass("masterstudy-alert_open")})),e(".masterstudy-form-builder__radio-group").each((function(){0===e(this).find(".masterstudy-form-builder__radio-wrapper_checked").length&&e(this).find(".masterstudy-form-builder__radio-container").first().find(".masterstudy-form-builder__radio-wrapper").addClass("masterstudy-form-builder__radio-wrapper_checked")})),setTimeout((function(){e(".masterstudy-form-builder__select").each((function(){var t=e(this).parent();e(this).select2({dropdownParent:t,minimumResultsForSearch:1/0})}))}),1500);var a={img:["image/png","image/jpeg","image/gif","image/svg+xml"],excel:["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],word:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],powerpoint:["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],pdf:["application/pdf"],video:["video/mp4","video/avi","video/flv","video/webm","video/x-ms-wmv","video/quicktime"],audio:["audio/mp3","audio/x-ms-wma","audio/aac","audio/mpeg"],archive:["application/zip","application/gzip","application/x-rar-compressed","application/x-7z-compressed","application/x-zip-compressed"]};function d(e,t){var a=null;return t.some((function(t){return e.closest(".".concat(t)).length>0&&(a=t,!0)})),a}function i(t,a,d,i){var s;e(t).parent().find(".masterstudy-file-upload__item").length>0?e(t).parent().find(".masterstudy-file-upload__field-error").addClass("masterstudy-file-upload__field-error_show").text(masterstudy_file_upload_data.only_one_file):(e(t).parent().find(".masterstudy-file-upload__field-error").removeClass("masterstudy-file-upload__field-error_show"),(s="drag"===i?a:a.files[0])&&function(t,a,d){var i=e(a).find(".masterstudy-file-upload__field-progress-bar-filled"),s=1,o=e(a).find(".masterstudy-hint__text").text(),r=0,n=0,u=0,f=new FormData;f.append("file",t),f.append("action",masterstudy_file_upload_data.file_upload_action),f.append("nonce",masterstudy_file_upload_data.file_upload_nonce),o.length>0&&f.append("extensions",o.trim());e.ajax({url:masterstudy_file_upload_data.ajax_url,type:"POST",data:f,processData:!1,contentType:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){e.lengthComputable&&(n=100===n?95:e.loaded/e.total/s*100,1===s&&i.css("width",n+"%"))}),!1),e},beforeSend:function(){e(a).parent().find(".masterstudy-file-upload__field").addClass("masterstudy-file-upload__field_loading")},success:function(o){r++,!1===o.error&&(t.id=o.id,function(t,a,d){var i=Math.round(t.size/1024),s=i>1e3?"mb":"kb",o=l(t.type).length>0?l(t.type):"unknown",r=masterstudy_file_upload_data.full_image_view?a:masterstudy_file_upload_data.icon_url+o+".svg";i=i>1e3?Math.round(i/1024):i;var n="";n=masterstudy_file_upload_data.full_image_view?'\n                <div class="masterstudy-file-upload__item masterstudy-file-upload__item_full-image">\n                    <img src="'.concat(r,'" class="masterstudy-file-upload__image">\n                    <a class="masterstudy-file-upload__link" href="#" data-id="').concat(t.id,'"></a>\n                </div>'):'\n                <div class="masterstudy-file-upload__item">\n                    <img src="'.concat(r,'" class="masterstudy-file-upload__image">\n                    <div class="masterstudy-file-upload__wrapper">\n                        <span class="masterstudy-file-upload__title">').concat(t.name,'</span>\n                        <span class="masterstudy-file-upload__size">').concat(i," ").concat(s,'</span>\n                        <a class="masterstudy-file-upload__link" href="#" data-id="').concat(t.id,'"></a>\n                    </div>\n                </div>');e(d).parent().find(".masterstudy-file-upload__item-wrapper").append(n),masterstudy_file_upload_data.full_image_view&&e(d).parent().find(".masterstudy-file-upload__field").addClass("masterstudy-file-upload__field_disabled")}(t,o.url,a)),1===s&&!1!==o.error&&(e(a).parent().find(".masterstudy-file-upload__field-error").text(o.message),e(a).parent().find(".masterstudy-file-upload__field-error").addClass("masterstudy-file-upload__field-error_show")),s===r?(i.css("width","100%"),setTimeout((function(){e(a).parent().find(".masterstudy-file-upload__field").removeClass("masterstudy-file-upload__field_loading"),i.css("width","0")}),500),setTimeout((function(){e(a).parent().find(".masterstudy-file-upload__field-error").removeClass("masterstudy-file-upload__field-error_show")}),1500),e(a).find(".masterstudy-file-upload__input").attr("data-url",o.url),e(a).parent().find(".".concat(d,"__form-field-error")).remove()):(u+=n,i.css("width",u+"%"))}})}(s,t,d),a.value=null)}function l(e){return Object.keys(a).filter((function(t){return a[t].includes(e)}))}}))}(jQuery);