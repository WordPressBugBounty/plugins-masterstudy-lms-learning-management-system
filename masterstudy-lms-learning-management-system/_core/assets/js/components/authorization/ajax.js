"use strict";function _createForOfIteratorHelper(t,a){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||a&&t&&"number"==typeof t.length){r&&(t=r);var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return n=t.done,t},e:function(t){s=!0,o=t},f:function(){try{n||null==r.return||r.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(t,a){if(t){if("string"==typeof t)return _arrayLikeToArray(t,a);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,a):void 0}}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var r=0,e=Array(a);r<a;r++)e[r]=t[r];return e}!function(t){function a(a,r){if(a.length>0){var e,i=_createForOfIteratorHelper(a);try{var o=function(){var a=e.value;if("checkbox"===a.type){var i=[];r.find('[name="'.concat(a.slug,'"]')).each((function(){t(this).next().hasClass("masterstudy-form-builder__checkbox-wrapper_checked")&&i.push(t(this).val())})),a.value=i.join(",")}else"radio"===a.type?r.find('[name="'.concat(a.slug,'"]')).each((function(){t(this).next().hasClass("masterstudy-form-builder__radio-wrapper_checked")&&(a.value=t(this).val())})):"file"===a.type?a.value=a.value?a.value:"":a.value=r.find('[name="'.concat(a.slug,'"]')).val()};for(i.s();!(e=i.n()).done;)o()}catch(t){i.e(t)}finally{i.f()}}}function r(t,a,r){var e=authorization_data.ajax_url+"?action=stm_lms_login&nonce="+authorization_data.login_nonce;r.find('[data-id="masterstudy-authorization-login-button"]').addClass("masterstudy-button_loading"),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){if(t.ok)return t.json();throw new Error("not ok")})).then((function(t){r.find('[data-id="masterstudy-authorization-login-button"]').removeClass("masterstudy-button_loading"),"error"!==t.status?"success"===t.status&&(a?window.location=t.user_page:location.reload()):t.errors.forEach((function(t){var a=r.find('input[name="'.concat(t.field,'"]')),e='<span data-error-id="'.concat(t.id,'" class="masterstudy-authorization__form-field-error">').concat(t.text,"</span>");a.length>0&&(a.parent().addClass("masterstudy-authorization__form-field_has-error"),0===a.parent().find('span[data-error-id="'.concat(t.id,'"]')).length&&a.after(e))}))}))}function e(t,a,r){var e=authorization_data.ajax_url+"?action=stm_lms_register&nonce="+authorization_data.register_nonce;r.find('[data-id="masterstudy-authorization-register-button"]').addClass("masterstudy-button_loading"),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){if(t.ok)return t.json();throw new Error("not ok")})).then((function(t){if(r.find('[data-id="masterstudy-authorization-register-button"]').removeClass("masterstudy-button_loading"),"error"!==t.status){if("success"===t.status){if(authorization_data.email_confirmation)return void o(!1,r);if(authorization_data.only_for_instructor&&authorization_data.instructor_premoderation)return void o(!0,r);a?window.location=t.user_page:location.reload()}}else i(t.errors,r)}))}function i(a,r){a.forEach((function(a){var e=r.find('[name="'.concat(a.field,'"]')),i='<span data-error-id="'.concat(a.id,'" class="masterstudy-authorization__form-field-error">').concat(a.text,"</span>");if(e.length>0)if("privacy_policy"===a.field||"recaptcha"===a.field){if(0===r.find(".masterstudy-authorization").find('span[data-error-id="'.concat(a.id,'"]')).length){var o=t(i);o.addClass("masterstudy-authorization__form-field-error_main masterstudy-authorization__form-field-error_".concat(a.field)),r.find(".masterstudy-authorization__actions").before(o)}}else if(e.parent().hasClass("masterstudy-form-builder__checkbox")){var n=e.closest(".masterstudy-form-builder__checkbox-group"),s=n.find(".masterstudy-form-builder__checkbox-description");t(n).parent().addClass("masterstudy-authorization__form-field_has-error"),0===n.find('span[data-error-id="'.concat(a.id,'"]')).length&&(s.length>0?t(i).insertBefore(s):e.closest(".masterstudy-form-builder__checkbox-group").append(i))}else if(e.closest(".masterstudy-form-builder__radio-group").length>0){var d=e.closest(".masterstudy-form-builder__radio-group");if(0===d.find('span[data-error-id="'.concat(a.id,'"]')).length){var u=d.find(".masterstudy-form-builder__radio-description");u.length>0?u.before(i):d.append(i)}}else if(e.parent().parent().hasClass("masterstudy-form-builder-file-upload")){var c=e.closest(".masterstudy-form-builder-file-upload");t(c).parent().addClass("masterstudy-authorization__form-field_has-error"),0===t(c).find('span[data-error-id="'.concat(a.id,'"]')).length&&t(c).find(".masterstudy-form-builder-file-upload__field").after(i)}else e.parent().addClass("masterstudy-authorization__form-field_has-error"),0===e.parent().find('span[data-error-id="'.concat(a.id,'"]')).length&&e.after(i)}));var e,i,o=r.closest(".masterstudy-authorization-modal__container"),n=r.find(".masterstudy-authorization__form-field_has-error").first();if(n.length>0){var s=n.offset().top;if(o.length>0){s-=o.offset().top;var d=o.scrollTop()+s-10;o.animate({scrollTop:d},500)}else e=n[0],(i=e.getBoundingClientRect()).top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)||t("html, body").animate({scrollTop:s-10},500)}}function o(t,a){a.find(".masterstudy-authorization__wrapper").addClass("masterstudy-authorization__wrapper_hide"),a.find(".masterstudy-authorization__switch").addClass("masterstudy-authorization__switch_hide"),t?a.find(".masterstudy-authorization__instructor-confirm").addClass("masterstudy-authorization__instructor-confirm_show"):a.find("#masterstudy-authorization-confirm-email").addClass("masterstudy-authorization__send-mail_show")}t(document).ready((function(){t(".masterstudy-authorization").each((function(){var n=t(this);n.find('[data-id="masterstudy-authorization-restore-button"]').click((function(t){t.preventDefault(),function(t){var a=authorization_data.ajax_url+"?action=stm_lms_lost_password&nonce="+authorization_data.restore_nonce,r=t.find('input[name="restore_user_login"]').val(),e=JSON.stringify({restore_user_login:r});t.find('[data-id="masterstudy-authorization-restore-button"]').addClass("masterstudy-button_loading"),fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:e}).then((function(t){if(t.ok)return t.json();throw new Error("not ok")})).then((function(a){t.find('[data-id="masterstudy-authorization-restore-button"]').removeClass("masterstudy-button_loading"),"error"!==a.status?"success"===a.status&&(t.find(".masterstudy-authorization__send-mail-content-subtitle").text((function(t,a){return a+r})),t.find(".masterstudy-authorization__restore").removeClass("masterstudy-authorization__restore_show"),t.find("#masterstudy-authorization-restore-pass").addClass("masterstudy-authorization__send-mail_show"),t.find(".masterstudy-authorization__switch").addClass("masterstudy-authorization__switch_hide")):a.errors.forEach((function(a){var r=t.find('input[name="'.concat(a.field,'"]')),e='<span data-error-id="'.concat(a.id,'" class="masterstudy-authorization__form-field-error">').concat(a.text,"</span>");r.length>0&&(r.parent().addClass("masterstudy-authorization__form-field_has-error"),0===r.parent().find('span[data-error-id="'.concat(a.id,'"]')).length&&r.after(e))}))}))}(n)})),n.find(".masterstudy-authorization__form-input").keypress((function(a){13===a.which&&(t(this).closest("#masterstudy-authorization-form-login").length>0?n.find('[data-id="masterstudy-authorization-login-button"]').trigger("click"):t(this).closest("#masterstudy-authorization-form-register").length>0&&n.find('[data-id="masterstudy-authorization-register-button"]').trigger("click"))}));var s=t(".masterstudy-authorization__strength-password"),d=s.find(".masterstudy-authorization__strength-password__separator");0===s.find(".masterstudy-authorization__strength-password__label").length&&s.append('<div class="masterstudy-authorization__strength-password__label"></div>');var u=s.find(".masterstudy-authorization__strength-password__label");t('input[name="register_user_password"]').on("input",(function(){var a=function(t){if(!t)return 0;var a=t.length,r=/[a-z]/.test(t),e=/[A-Z]/.test(t),i=/[0-9]/.test(t);if(a>=8&&a<=11&&r&&e&&i)return 2;if(a>=12&&a<=15&&r&&e&&i)return 3;if(a>=16&&r&&e&&i)return 4;return 1}(t(this).val()),r="";switch(s.removeClass("bad normal good hard"),a){case 1:s.addClass("bad"),r=masterstudy_authorization_data.bad||"Bad";break;case 2:s.addClass("normal"),r=masterstudy_authorization_data.normal||"Normal";break;case 3:s.addClass("good"),r=masterstudy_authorization_data.good||"Good";break;case 4:s.addClass("hard"),r=masterstudy_authorization_data.hard||"Hard"}u.text(r),d.removeClass("active"),d.each((function(r){r<a&&t(this).addClass("active")}))})),n.find('[data-id="masterstudy-authorization-login-button"]').click((function(t){t.preventDefault();var a={user_login:n.find('input[name="user_login"]').val(),user_password:n.find('input[name="user_password"]').val(),remember:n.find("#masterstudy-authorization-remember").prop("checked")};authorization_data.recaptcha_site_key&&"undefined"!=typeof grecaptcha?grecaptcha.ready((function(){grecaptcha.execute(authorization_data.recaptcha_site_key,{action:"login"}).then((function(t){a.recaptcha=t,r(a,authorization_data.only_for_instructor,n)}))})):r(a,authorization_data.only_for_instructor,n)})),n.find('[data-id="masterstudy-authorization-register-button"]').click((function(t){if(t.preventDefault(),Object.keys(authorization_data.default_fields).length>0)for(var r in authorization_data.default_fields)authorization_data.default_fields.hasOwnProperty(r)&&(authorization_data.default_fields[r].value=n.find('[name="'.concat(r,'"]')).val());authorization_data.additional_fields.length>0&&a(authorization_data.additional_fields,n),authorization_data.instructor_fields.length>0&&a(authorization_data.instructor_fields,n);var i={register_user_login:n.find('input[name="register_user_login"]').val(),register_user_email:n.find('input[name="register_user_email"]').val(),register_user_password:n.find('input[name="register_user_password"]').val(),register_user_password_re:n.find('input[name="register_user_password_re"]').val(),profile_default_fields_for_register:authorization_data.default_fields,become_instructor:!!authorization_data.only_for_instructor||n.find("#masterstudy-authorization-instructor").length>0&&n.find("#masterstudy-authorization-instructor").prop("checked"),additional:authorization_data.additional_fields,privacy_policy:!(n.find("#masterstudy-authorization-gdbr").length>0)||n.find("#masterstudy-authorization-gdbr").prop("checked"),redirect_page:authorization_data.only_for_instructor?authorization_data.user_account_page:window.location.href};i.additional_instructors=i.become_instructor?authorization_data.instructor_fields:[],i.degree=n.find('input[name="degree"]').length>0&&i.become_instructor?n.find('input[name="degree"]').val():"",i.expertize=n.find('input[name="expertize"]').length>0&&i.become_instructor?n.find('input[name="expertize"]').val():"",authorization_data.recaptcha_site_key&&"undefined"!=typeof grecaptcha?grecaptcha.ready((function(){grecaptcha.execute(authorization_data.recaptcha_site_key,{action:"register"}).then((function(t){i.recaptcha=t,e(i,authorization_data.only_for_instructor,n)}))})):e(i,authorization_data.only_for_instructor,n)})),n.find('[data-id="masterstudy-authorization-instructor-confirm"]').click((function(r){r.preventDefault();var e={fields_type:"default",fields:{degree:n.find('input[name="degree"]').length?n.find('input[name="degree"]').val():"",expertize:n.find('input[name="expertize"]').length?n.find('input[name="expertize"]').val():""}};authorization_data.instructor_fields.length>0&&(a(authorization_data.instructor_fields,n),e.fields=authorization_data.instructor_fields,e.fields_type="custom"),function(a,r){t.ajax({url:authorization_data.ajax_url+"?action=stm_lms_become_instructor&nonce="+authorization_data.instructor_nonce,method:"POST",data:a,beforeSend:function(){r.find('[data-id="masterstudy-authorization-instructor-confirm"]').addClass("masterstudy-button_loading")},success:function(t){if(r.find('[data-id="masterstudy-authorization-instructor-confirm"]').removeClass("masterstudy-button_loading"),"error"!==t.status){if("success"===t.status){if(authorization_data.only_for_instructor&&authorization_data.instructor_premoderation)return void o(!0,r);window.location=authorization_data.user_account_page}}else i(t.errors,r)}})}(e,n)}))}))}))}(jQuery);