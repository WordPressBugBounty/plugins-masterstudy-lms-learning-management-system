"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=Array(t);i<t;i++)s[i]=e[i];return s}function _iterableToArrayLimit(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var s,r,a,o,l=[],n=!0,u=!1;try{if(a=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;n=!1}else for(;!(n=(s=a.call(i)).done)&&(l.push(s.value),l.length!==t);n=!0);}catch(e){u=!0,r=e}finally{try{if(!n&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw r}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,_toPropertyKey(s.key),s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=_typeof(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var MasterstudyAudioPlayer=function(){function e(t,i){var s,r,a;if(_classCallCheck(this,e),this.audioPlayer="string"==typeof t?document.querySelector(t):t,!this.audioPlayer.dataset.initialized){this.audioPlayer.dataset.initialized=!0;var o=i||{};this.audioPlayer.classList.add("masterstudy-audio-player"),this.progressDisplay=document.getElementById("current-audio-progress"),this.progressUserDisplay=document.getElementById("current-audio-progress-user"),this.userProgress=parseInt(null===(s=document.getElementById("current-audio-progress"))||void 0===s||null===(s=s.dataset)||void 0===s?void 0:s.progress,10)||0,this.requiredProgress=parseInt(null===(r=document.querySelector("#required-audio-progress"))||void 0===r?void 0:r.getAttribute("data-required-progress"),10)||0,this.submitButton=document.querySelector('[data-id="masterstudy-course-player-lesson-submit"]'),this.hint=document.querySelector(".masterstudy-course-player-navigation__next .masterstudy-hint"),this.dataQuery=null===(a=this.submitButton)||void 0===a?void 0:a.getAttribute("data-query"),this.initialLoad=!0,this.isDevice=/ipad|iphone|ipod|android/i.test(window.navigator.userAgent.toLowerCase())&&!window.MSStream,this.playPauseBtn=this.audioPlayer.querySelector(".masterstudy-audio-player__play-pause-btn"),this.loading=this.audioPlayer.querySelector(".masterstudy-audio-player__loading"),this.sliders=this.audioPlayer.querySelectorAll(".masterstudy-audio-player__slider"),this.progress=this.audioPlayer.querySelector(".masterstudy-audio-player__controls-progress"),this.volumeBtn=this.audioPlayer.querySelector(".masterstudy-audio-player__volume-button"),this.volumeControls=this.audioPlayer.querySelector(".masterstudy-audio-player__volume-controls"),this.volumeProgress=this.volumeControls.querySelector(".masterstudy-audio-player__volume-progress"),this.player=this.audioPlayer.querySelector("audio"),this.currentTime=this.audioPlayer.querySelector(".masterstudy-audio-player__controls-current-time"),this.totalTime=this.audioPlayer.querySelector(".masterstudy-audio-player__controls-total-time"),this.speaker=this.audioPlayer.querySelector(".masterstudy-audio-player__volume-speaker"),this.download=this.audioPlayer.querySelector(".masterstudy-audio-player__download"),this.downloadLink=this.audioPlayer.querySelector(".masterstudy-audio-player__download-link"),this.span=this.audioPlayer.querySelectorAll(".masterstudy-audio-player__message-offscreen"),this.svg=this.audioPlayer.getElementsByTagName("svg"),this.img=this.audioPlayer.getElementsByTagName("img"),this.draggableClasses=["masterstudy-audio-player__pin"],this.currentlyDragged=null,this.stopOthersOnPlay=o.stopOthersOnPlay||!0,this.enableKeystrokes=o.enableKeystrokes||!1,this.showTooltips=o.showTooltips||!1,this.showDeleteButton=o.showDeleteButton||!1,this.playbackSpeedSelect=document.getElementById("playback-speed"),this.playbackSpeedSelect&&this.playbackSpeedSelect.addEventListener("change",this.changePlaybackSpeed.bind(this)),this.userProgress<this.requiredProgress&&this.submitButton&&(this.submitButton.setAttribute("disabled","true"),this.submitButton.classList.add("masterstudy-button_disabled"));var l=this;if(this.labels={volume:{open:"Open Volume Controls",close:"Close Volume Controls"},pause:"Pause",play:"Play",download:"Download"},this.enableKeystrokes){window.addEventListener("keydown",this.pressKb.bind(l),!1),window.addEventListener("keyup",this.unPressKb.bind(l),!1),this.sliders[0].setAttribute("tabindex",0),this.sliders[1].setAttribute("tabindex",0),this.download.setAttribute("tabindex",-1),this.downloadLink.setAttribute("tabindex",-1);for(var n=0;n<this.svg.length;n++)this.svg[n].setAttribute("tabindex",0),this.svg[n].setAttribute("focusable",!0);for(var u=0;u<this.img.length;u++)this.img[u].setAttribute("tabindex",0)}else for(var d=0;d<this.span.length;d++)this.span[d].outerHTML="";if(this.showTooltips&&(this.playPauseBtn.setAttribute("title",this.labels.play),this.volumeBtn.setAttribute("title",this.labels.volume.open),this.downloadLink.setAttribute("title",this.labels.download)),o.outlineControls&&this.audioPlayer.classList.add("masterstudy-audio-player_accessible"),o.showDownloadButton,this.showDownload(),this.initEvents(),this.directionAware(),this.overcomeIosLimitations(),"autoplay"in this.player.attributes){var y=this.player.play();void 0!==y&&y.then((function(){l.player.parentElement.querySelector(".masterstudy-audio-player__play-pause-btn__icon").attributes.d.value="M0 0h6v24H0zM12 0h6v24h-6z",l.playPauseBtn.setAttribute("aria-label",l.labels.pause),l.hasSetAttribute(l.playPauseBtn,"title",l.labels.pause)})).catch((function(){console.error("MasterStudy Audio Player Error: Autoplay has been prevented, because it is not allowed by this browser.")}))}"preload"in this.player.attributes&&"none"===this.player.attributes.preload.value&&(this.playPauseBtn.style.visibility="visible",this.loading.style.visibility="hidden")}}return _createClass(e,[{key:"changePlaybackSpeed",value:function(){if(this.playbackSpeedSelect){var e=parseFloat(this.playbackSpeedSelect.value);this.player.playbackRate=e}}},{key:"initEvents",value:function(){var t=this,i=this;i.audioPlayer.addEventListener("mousedown",(function(e){if(i.isDraggable(e.target)){i.currentlyDragged=e.target;var t=i.currentlyDragged.dataset.method,s=i[t].bind(i);window.addEventListener("mousemove",s,!1),i.currentlyDragged.parentElement.parentElement===i.sliders[0]&&(i.paused=i.player.paused,!1===i.paused&&i.togglePlay()),window.addEventListener("mouseup",(function(){!1!==i.currentlyDragged&&i.currentlyDragged.parentElement.parentElement===i.sliders[0]&&i.paused!==i.player.paused&&i.togglePlay(),i.currentlyDragged=!1,window.removeEventListener("mousemove",s,!1)}),!1)}})),i.audioPlayer.addEventListener("touchstart",(function(e){if(i.isDraggable(e.target)){var t=_slicedToArray(e.targetTouches,1);i.currentlyDragged=t[0];var s=i.currentlyDragged.target.dataset.method,r=i[s].bind(i);window.addEventListener("touchmove",r,!1),i.currentlyDragged.parentElement.parentElement===i.sliders[0]&&(i.paused=i.player.paused,!1===i.paused&&i.togglePlay()),window.addEventListener("touchend",(function(){!1!==i.currentlyDragged&&i.currentlyDragged.parentElement.parentElement===i.sliders[0]&&i.paused!==i.player.paused&&i.togglePlay(),i.currentlyDragged=!1,window.removeEventListener("touchmove",r,!1)}),!1),e.preventDefault()}})),this.playPauseBtn.addEventListener("click",this.togglePlay.bind(i)),this.player.addEventListener("timeupdate",this.updateProgress.bind(i)),this.player.addEventListener("volumechange",this.updateVolume.bind(i)),this.player.volume=.81,this.player.addEventListener("loadedmetadata",(function(){t.totalTime.textContent=e.formatTime(t.player.duration,t.player)})),this.player.addEventListener("seeking",(function(){i.toggleLoadingIndicator(!0)})),this.player.addEventListener("seeked",(function(){i.toggleLoadingIndicator(!1)})),this.player.addEventListener("canplay",(function(){i.toggleLoadingIndicator(!1)})),this.player.addEventListener("ended",(function(){if(e.playPausePlayer(i.player,!0),i.player.currentTime=0,i.playPauseBtn.setAttribute("aria-label",i.labels.play),i.hasSetAttribute(i.playPauseBtn,"title",i.labels.play),t.progressDisplay&&audio_player_data.audio_progress){if(t.userProgress=100,t.dataQuery){var s=JSON.parse(t.dataQuery);s.progress=t.userProgress,t.submitButton.setAttribute("data-query",JSON.stringify(s)),t.hint.style.display="none",t.submitButton.removeAttribute("disabled"),t.submitButton.classList.remove("masterstudy-button_disabled")}t.progressUserDisplay.textContent="".concat(t.userProgress,"%"),t.progressDisplay.style.width="".concat(t.userProgress,"%"),t.progressDisplay.setAttribute("data-progress",t.userProgress)}})),this.volumeBtn.addEventListener("click",this.showHideVolume.bind(i)),document.addEventListener("click",(function(e){i.volumeControls.contains(e.target)||i.volumeBtn.contains(e.target)||(i.volumeControls.classList.add("hidden"),i.volumeBtn.setAttribute("aria-label",i.labels.volume.open),i.hasSetAttribute(i.volumeBtn,"title",i.labels.volume.open),i.volumeBtn.classList.remove("open"))})),window.addEventListener("resize",i.directionAware.bind(i)),window.addEventListener("scroll",i.directionAware.bind(i));for(var s=0;s<this.sliders.length;s++){var r=this.sliders[s].querySelector(".masterstudy-audio-player__pin");this.sliders[s].addEventListener("click",i[r.dataset.method].bind(i))}this.downloadLink.addEventListener("click",this.downloadAudio.bind(i)),this.player.load()}},{key:"overcomeIosLimitations",value:function(){var e=this;if(this.isDevice){this.player.addEventListener("loadedmetadata",(function(){e.toggleLoadingIndicator(!1)})),this.audioPlayer.querySelector(".masterstudy-audio-player__volume").style.display="none";var t=this.audioPlayer.querySelector(".masterstudy-audio-player__controls");document.body.classList.contains("rtl")?t.style.marginLeft="0":t.style.marginRight="0"}}},{key:"isDraggable",value:function(e){var t=!1;if(void 0===e.classList)return!1;for(var i=0;i<this.draggableClasses.length;i++)e.classList.contains(this.draggableClasses[i])&&(t=!0);return t}},{key:"inRange",value:function(e){var t="touches"in e,i=this.getRangeBox(e),s=i.getBoundingClientRect(),r=null,a=null;if("horizontal"===i.dataset.direction){a=(r=s.x)+s.width;var o=t?e.touches[0].clientX:e.clientX;if(o<r||o>a)return!1}else{a=(r=s.top)+s.height;var l=t?e.touches[0].clientY:e.clientY;if(l<r||l>a)return!1}return!0}},{key:"updateProgress",value:function(){var t=this.player.currentTime,i=t/this.player.duration*100;if(this.progress.setAttribute("aria-valuenow",i),this.progress.style.width="".concat(i,"%"),this.currentTime.textContent=e.formatTime(t,this.player),this.progressDisplay&&audio_player_data.audio_progress){if(this.initialLoad&&this.userProgress>0)return;this.initialLoad=!1;var s=!isNaN(this.player.duration)&&this.player.duration>0?Math.floor(this.player.currentTime/this.player.duration*100):0;if(this.userProgress>=this.requiredProgress&&(this.hint.style.display="none",this.submitButton.removeAttribute("disabled"),this.submitButton.classList.remove("masterstudy-button_disabled")),this.userProgress>Math.floor(s))return;if(Math.floor(s)>100&&(s=100),this.userProgress=Math.floor(s),this.dataQuery){var r=JSON.parse(this.dataQuery);r.progress=this.userProgress,this.submitButton.setAttribute("data-query",JSON.stringify(r))}this.progressUserDisplay.textContent="".concat(this.userProgress,"%"),this.progressDisplay.style.width="".concat(this.userProgress,"%"),this.progressDisplay.setAttribute("data-progress",this.userProgress)}}},{key:"updateVolume",value:function(){this.volumeProgress.setAttribute("aria-valuenow",100*this.player.volume),this.volumeProgress.style.height="".concat(100*this.player.volume,"%"),this.player.volume>=.5?this.speaker.attributes.d.value="M14.667 0v2.747c3.853 1.146 6.666 4.72 6.666 8.946 0 4.227-2.813 7.787-6.666 8.934v2.76C20 22.173 24 17.4 24 11.693 24 5.987 20 1.213 14.667 0zM18 11.693c0-2.36-1.333-4.386-3.333-5.373v10.707c2-.947 3.333-2.987 3.333-5.334zm-18-4v8h5.333L12 22.36V1.027L5.333 7.693H0z":this.player.volume<.5&&this.player.volume>.05?this.speaker.attributes.d.value="M0 7.667v8h5.333L12 22.333V1L5.333 7.667M17.333 11.373C17.333 9.013 16 6.987 14 6v10.707c2-.947 3.333-2.987 3.333-5.334z":this.player.volume<=.05&&(this.speaker.attributes.d.value="M0 7.667v8h5.333L12 22.333V1L5.333 7.667")}},{key:"getRangeBox",value:function(e){var t=e.target,i=this.currentlyDragged;return"click"===e.type&&this.isDraggable(e.target)&&(t=e.target.parentElement.parentElement),"mousemove"===e.type&&(t=i.parentElement.parentElement),"touchmove"===e.type&&(t=i.target.parentElement.parentElement),t}},{key:"getCoefficient",value:function(e){var t="touches"in e,i=this.getRangeBox(e),s=i.getBoundingClientRect(),r=0;if("horizontal"===i.dataset.direction)r=((t?e.touches[0].clientX:e.clientX)-s.left)/s.width;else if("vertical"===i.dataset.direction){var a=s.height;r=1-((t?e.touches[0].clientY:e.clientY)-s.top)/a}return r}},{key:"rewind",value:function(e){this.player.seekable&&this.player.seekable.length&&this.inRange(e)&&(this.player.currentTime=this.player.duration*this.getCoefficient(e))}},{key:"showVolume",value:function(){this.volumeBtn.getAttribute("aria-attribute")===this.labels.volume.open&&(this.volumeControls.classList.remove("hidden"),this.volumeBtn.classList.add("open"),this.volumeBtn.setAttribute("aria-label",this.labels.volume.close),this.hasSetAttribute(this.volumeBtn,"title",this.labels.volume.close))}},{key:"showHideVolume",value:function(){this.volumeControls.classList.toggle("hidden"),this.volumeBtn.getAttribute("aria-label")===this.labels.volume.open?(this.volumeBtn.setAttribute("aria-label",this.labels.volume.close),this.hasSetAttribute(this.volumeBtn,"title",this.labels.volume.close),this.volumeBtn.classList.add("open")):(this.volumeBtn.setAttribute("aria-label",this.labels.volume.open),this.hasSetAttribute(this.volumeBtn,"title",this.labels.volume.open),this.volumeBtn.classList.remove("open"))}},{key:"changeVolume",value:function(e){this.inRange(e)&&(this.player.volume=Math.round(50*this.getCoefficient(e))/50)}},{key:"preloadNone",value:function(){this.player.duration||(this.playPauseBtn.style.visibility="hidden",this.loading.style.visibility="visible")}},{key:"togglePlay",value:function(){this.player.paused?(this.stopOthersOnPlay&&e.stopOtherPlayers(),e.playPausePlayer(this.player),this.playPauseBtn.setAttribute("aria-label",this.labels.pause),this.hasSetAttribute(this.playPauseBtn,"title",this.labels.pause)):(e.playPausePlayer(this.player,!0),this.playPauseBtn.setAttribute("aria-label",this.labels.play),this.hasSetAttribute(this.playPauseBtn,"title",this.labels.play))}},{key:"hasSetAttribute",value:function(e,t,i){this.showTooltips&&e.hasAttribute(t)&&e.setAttribute(t,i)}},{key:"setCurrentTime",value:function(e){var t=this.player.currentTime,i=Math.floor(this.player.duration);t+e<0&&0===t?this.player.currentTime=this.player.currentTime:t+e<0?this.player.currentTime=0:t+e>i?this.player.currentTime=i:this.player.currentTime+=e}},{key:"setVolume",value:function(e){if(!this.isDevice){var t=this.player.volume;t+e>=0&&t+e<1?this.player.volume+=e:this.player.volume=t+e<=0?0:1}}},{key:"unPressKb",value:function(e){var t=e||window.event;!this.seeking||37!==t.keyCode&&39!==t.keyCode||(this.togglePlay(),this.seeking=!1)}},{key:"pressKb",value:function(e){var t=e||window.event;switch(t.keyCode){case 13:case 32:if(document.activeElement.parentNode===this.playPauseBtn)this.togglePlay();else if(document.activeElement.parentNode===this.volumeBtn||document.activeElement===this.sliders[1]){if(document.activeElement===this.sliders[1])try{this.volumeBtn.children[0].focus()}catch(e){this.volumeBtn.focus()}this.showHideVolume()}13===t.keyCode&&this.showDownload&&document.activeElement.parentNode===this.downloadLink&&this.downloadLink.focus();break;case 37:case 39:document.activeElement===this.sliders[0]&&(this.setCurrentTime(37===t.keyCode?-5:5),!this.player.paused&&this.player.seeking&&(this.togglePlay(),this.seeking=!0));break;case 38:case 40:document.activeElement.parentNode!==this.volumeBtn&&document.activeElement!==this.sliders[1]||this.setVolume(38===t.keyCode?.05:-.05),document.activeElement.parentNode===this.volumeBtn&&this.showVolume()}}},{key:"toggleLoadingIndicator",value:function(e){this.playPauseBtn.style.visibility=e?"hidden":"visible",this.loading.style.visibility=e?"visible":"hidden"}},{key:"showDownload",value:function(){this.download.classList.add("masterstudy-audio-player__download_visible")}},{key:"downloadAudio",value:function(){var e=this.player.currentSrc,t=e.split("/").reverse()[0];this.downloadLink.setAttribute("href",e),this.downloadLink.setAttribute("download",t)}},{key:"directionAware",value:function(){this.volumeControls.classList.remove("top","middle","bottom"),window.innerHeight<250?this.volumeControls.classList.add("middle"):this.audioPlayer.getBoundingClientRect().top<210?this.volumeControls.classList.add("bottom"):this.volumeControls.classList.add("top")}}],[{key:"init",value:function(t){document.querySelectorAll(t.selector).forEach((function(i){new e(i,t)}))}},{key:"formatTime",value:function(e,t){if(!isNaN(t.duration)&&isFinite(t.duration)){var i=Math.floor(e/60),s=Math.floor(e%60);return"".concat(i<10?"0".concat(i):i,":").concat(s<10?"0".concat(s):s)}return"00:00"}},{key:"playPausePlayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.parentElement.querySelector(".masterstudy-audio-player__play-pause-btn__icon").attributes.d.value=t?"M18 12L0 24V0":"M0 0h6v24H0zM12 0h6v24h-6z",t?e.pause():e.play()}},{key:"stopOtherPlayers",value:function(){for(var t=document.querySelectorAll(".masterstudy-audio-player audio"),i=0;i<t.length;i++)e.playPausePlayer(t[i],!0)}}]),e}();