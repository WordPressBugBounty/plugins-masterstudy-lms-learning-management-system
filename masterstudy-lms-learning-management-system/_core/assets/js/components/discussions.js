"use strict";!function(s){s(document).ready((function(){var t="",n=0;function i(t,i,e){s.ajax({url:discussions_data.ajax_url,dataType:"json",data:{action:"stm_lms_get_comments",nonce:discussions_data.get_nonce,post_id:discussions_data.lesson_id,lesson_type:discussions_data.lesson_type,offset:t,search:e},beforeSend:function(){s(".masterstudy-discussions__load-more").addClass("masterstudy-discussions__load-more_loading")},success:function(t){var o,c="",u=s(".masterstudy-discussions__content");if(t.posts.length>0)s(".masterstudy-discussions").removeClass("masterstudy-discussions_not-items"),t.posts.forEach((function(s){c+=a(s,!1),s.replies.length>0&&(c+=d(s.replies))})),u.html(i?u.html()+c:c);else if(e.length>0)t.message=(o=t.message,'<div class="masterstudy-discussions__not-found">'.concat(o,"</div>")),u.html(t.message),s(".masterstudy-discussions").removeClass("masterstudy-discussions_not-items");else{s(".masterstudy-discussions").addClass("masterstudy-discussions_not-items");var r='\n                <div class="masterstudy-discussions__not-items">\n                    <span class="masterstudy-discussions__not-items-icon"></span>\n                    <span class="masterstudy-discussions__not-items-title">\n                        '.concat(discussions_data.not_items_title,'\n                    </span>\n                    <span class="masterstudy-discussions__not-items-subtitle">\n                        ').concat(discussions_data.not_items_subtitle,"\n                    </span>\n                </div>");u.html(r)}t.navigation?(n++,s(".masterstudy-discussions__navigation").addClass("masterstudy-discussions__navigation_show")):s(".masterstudy-discussions__navigation").removeClass("masterstudy-discussions__navigation_show"),s(".masterstudy-discussions__search-add").removeClass("masterstudy-discussions__search-add_loading"),s(".masterstudy-discussions__load-more").removeClass("masterstudy-discussions__load-more_loading")}})}function e(e,a){var d=s(".masterstudy-discussions__header .masterstudy-discussions__send");s.ajax({url:discussions_data.ajax_url,dataType:"json",data:{action:"stm_lms_add_comment",nonce:discussions_data.add_nonce,post_id:discussions_data.lesson_id,course_id:discussions_data.course_id,lesson_type:discussions_data.lesson_type,comment:e,parent:a},beforeSend:function(){0===a&&(d.find(".masterstudy-discussions__send-button").addClass("masterstudy-discussions__send-button_loading"),d.find(".masterstudy-discussions__error").remove())},success:function(e){var o;"error"===e.status?(e.message=(o=e.message,'\n            <div class="masterstudy-discussions__error">\n                '.concat(o,"\n            </div>\n            ")),s(".masterstudy-discussions__send-comment").after(e.message),d.find(".masterstudy-discussions__send-button").removeClass("masterstudy-discussions__send-button_loading")):Object.keys(e.comment).length>0&&(n=0,i(0,!1,t=""),0===a&&(d.find(".masterstudy-discussions__textarea").val(""),d.hide(200),d.next().show(200),d.find(".masterstudy-discussions__send-button").removeClass("masterstudy-discussions__send-button_loading")))}})}function a(s,t){var n="masterstudy-discussions__comment",i="";return t&&(n+=" masterstudy-discussions__comment_reply"),s.author.is_instructor.length>0&&(i='<span class="masterstudy-discussions__role">'.concat(s.author.is_instructor,"</span>")),'\n                <div class="'.concat(n,'">\n                    <div class="masterstudy-discussions__avatar">\n                        <img src="').concat(s.author.avatar_url,'" class="masterstudy-discussions__avatar-image">\n                    </div>\n                    <div class="masterstudy-discussions__main">\n                        <div class="masterstudy-discussions__user">\n                            <div class="masterstudy-discussions__wrapper">\n                                <a class="masterstudy-discussions__name"\n                                    ').concat(discussions_data.instructor_public_profile&&s.author.is_instructor||discussions_data.student_public_profile&&!s.author.is_instructor?'href="'.concat(s.author.url,'"'):"",">\n                                    ").concat(s.author.login,"\n                                </a>\n                                ").concat(i,'\n                            </div>\n                            <div class="masterstudy-discussions__time">').concat(s.datetime,'</div>\n                        </div>\n                        <div class="masterstudy-discussions__message" id="').concat(s.comment_ID,'">\n                            <div class="masterstudy-discussions__text">').concat(s.content,'</div>\n                            <div class="masterstudy-discussions__reply">\n                                <span class="masterstudy-discussions__reply-button">').concat(discussions_data.reply_title,"</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>")}function d(s){var t="";return s.forEach((function(s){t+=a(s,!0),s.replies.length>0&&(t+=d(s.replies))})),t}i(n,!1,t),s('[data-id="masterstudy-discussions-add-comment"]').click((function(t){t.preventDefault(),s(this).parent().hide(200),s(this).parent().prev().show(200)})),s(document).on("click",".masterstudy-discussions__cancel",(function(t){t.preventDefault();var n=s(this);s(this).parent().hide(200),s(this).parent().next().show(200),s(this).parent().find(".masterstudy-discussions__textarea").val(""),setTimeout((function(){n.parent().find(".masterstudy-discussions__error").remove()}),150),s(this).parent().parent().hasClass("masterstudy-discussions__reply")&&setTimeout((function(){n.parent().remove()}),400)})),s(document).on("click",".masterstudy-discussions__reply-button",(function(){var t='\n                <div class="masterstudy-discussions__send" style="display:none;">\n                    <div class="masterstudy-discussions__send-comment">\n                        <textarea\n                            name="masterstudy-discussions-comment-textarea"\n                            class="masterstudy-discussions__textarea"\n                            placeholder="'.concat(discussions_data.textarea_placeholder,'"\n                            rows="3"\n                        ></textarea>\n                        <div class="masterstudy-discussions__send-wrapper">\n                            <button class="masterstudy-discussions__send-button"></button>\n                        </div>\n                    </div>\n                    <button class="masterstudy-discussions__cancel">\n                        ').concat(discussions_data.cancel_title,"\n                    </button>\n                </div>\n            "),n=s(this).closest(".masterstudy-discussions__comment").siblings().find(".masterstudy-discussions__send");n.hide(200),setTimeout((function(){n.remove()}),200),s(this).closest(".masterstudy-discussions__comment").siblings().find(".masterstudy-discussions__reply-button").show(200),s(this).parent().prepend(t),s(this).hide(200),s(this).parent().find(".masterstudy-discussions__send").show(200)})),s(".masterstudy-discussions__search-button").click((function(){s(this).parent().hide(200),s(this).parent().prev().prev().show(150)})),s(".masterstudy-discussions__search-close").click((function(){s(this).parent().parent().hide(150),s(this).parent().parent().next().next().show(200),s("#masterstudy-discussions-search").val(""),n=0,i(0,!1,t="")})),s(document).on("keydown","#masterstudy-discussions-search",(function(e){13===e.keyCode&&(e.preventDefault(),s(".masterstudy-discussions__search-add").addClass("masterstudy-discussions__search-add_loading"),t=s(this).val(),n=0,i(0,!1,t))})),s(document).on("click",".masterstudy-discussions__search-add",(function(){s(this).addClass("masterstudy-discussions__search-add_loading"),t=s("#masterstudy-discussions-search").val(),n=0,i(0,!1,t)})),s(document).on("click",".masterstudy-discussions__load-more",(function(){i(n,!0,t)})),s(document).on("click",".masterstudy-discussions__send-button",(function(){var t=s(this).closest(".masterstudy-discussions__send"),n=t.find(".masterstudy-discussions__textarea").val();n.length>0&&(t.parent().hasClass("masterstudy-discussions__reply")?(s(this).addClass("masterstudy-discussions__send-button_loading"),e(n,t.parent().parent().attr("id"))):e(n,0))}))}))}(jQuery);