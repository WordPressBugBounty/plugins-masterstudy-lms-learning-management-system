"use strict";jQuery(document).ready((function(){new Vue({el:"#stm_lms_enterprise_groups",data:function(){return{loading:!1,groups:[],groupData:{group_id:"",title:"",emails:[]},newEmail:"",status:"",message:"",external_data:window.stm_lms_groups,file:"",file_message:""}},mounted:function(){void 0===this.group&&this.$set(this,"group",[]),this.fetchGroups()},computed:{},methods:{fetchGroups:function(){var t=this,e=stm_lms_ajaxurl+"?action=stm_lms_get_enterprise_groups&nonce="+stm_lms_nonces.stm_lms_get_enterprise_groups;t.loading=!0,this.$http.get(e).then((function(e){t.$set(t,"groups",e.body),t.loading=!1}),(function(){t.loading=!1}))},deleteGroup:function(t){var e=this;if(confirm('Do you really want to delete group "'+t.title+'"?')){var s=stm_lms_ajaxurl+"?action=stm_lms_delete_enterprise_group&nonce="+stm_lms_nonces.stm_lms_delete_enterprise_group+"&group_id="+t.group_id;e.loading=!0,e.$http.get(s).then((function(t){e.fetchGroups(),e.loading=!1}))}},addNewEmail:function(){var t=this;return!!t.validEmail(t.newEmail)&&!t.groupData.emails.includes(t.newEmail)&&("string"==typeof t.groupData.emails&&(t.groupData.emails=[]),t.groupData.emails.length<t.external_data.limit&&t.groupData.emails.push(t.newEmail),void(t.newEmail=""))},validEmail:function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},addGroup:function(){var t=this;if(!t.groupData.title)return!1;if(!t.groupData.emails.length)return!1;var e=stm_lms_ajaxurl+"?action=stm_lms_add_enterprise_group&nonce="+stm_lms_nonces.stm_lms_add_enterprise_group;t.loading=!0,console.log(t.groupData),this.$http.post(e,t.groupData).then((function(e){var s=e.body.status,i=e.body.message;t.status=s,t.message=i,"error"!==s&&t.fetchGroups(),t.loading=!1,t.resetGroupEditing()}))},resetGroupEditing:function(){this.groupData={group_id:"",title:"",emails:[]}},handleFileUpload:function(){this.$set(this,"file",this.$refs.lms_group_csv.files[0])},submitFile:function(){var t=this,e=new FormData;e.append("file",this.file);var s=stm_lms_ajaxurl+"?action=stm_lms_import_groups&nonce="+stm_lms_nonces.stm_lms_import_groups;t.loading=!0,t.$http.post(s,e,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){var s=e.body;if(t.loading=!1,s.message)return t.file_message=s.message,!1;t.fetchGroups(),t.clearFile()}))},clearFile:function(){this.$set(this,"file",""),this.$set(this,"file_message","")}}})}));